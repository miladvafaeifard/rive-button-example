<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rive canvas</title>
  </head>
  <body>
    <div>
      <canvas id="riveCanvas" width=512 height=512></canvas>
    </div>

    <script src="https://unpkg.com/rive-canvas@0.6.5/rive.js"></script>
    <script>
      Rive({
        locateFile: (file) => 'https://unpkg.com/rive-canvas@0.6.5/' + file,
      }).then((rive) => {
        // load a file
        const req = new Request('./new_rive_app.riv');
        fetch(req)
          .then((res) => res.arrayBuffer())
          .then((buf) => {
            const file = rive.load(new Uint8Array(buf));
            console.log('file: ', file);
            const artboard = file.defaultArtboard();
            const myAnim = artboard.animation('animation_name');
            const myAnimInstance = new rive.LinearAnimationInstance(myAnim);

            // play an animation
            const canvas = document.getElementById('riveCanvas');
            const ctx = canvas.getContext('2d');
            const renderer = new rive.CanvasRenderer(ctx);

            artboard.advance(0);

            ctx.save();
            renderer.align(
              rive.Fit.contain,
              rive.Alignment.center,
              {
                minX: 0,
                minY: 0,
                maxX: canvas.width,
                maxY: canvas.height,
              },
              artboard.bounds
            );

            artboard.draw(renderer);
            ctx.restore();

            let lastTime = 0;

            function draw(time) {
              if (!lastTime) {
                lastTime = time;
              }
              const elapsedTime = (time - lastTime) / 1000;
              lastTime = time;

              myAnimInstance.advance(elapsedTime);
              myAnimInstance.apply(artboard, 1.0);
              artboard.advance(elapsedTime);
              
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              ctx.save();
              renderer.align(
                rive.Fit.contain,
                rive.Alignment.center,
                {
                  minX: 0,
                  minY: 0,
                  maxX: canvas.width,
                  maxY: canvas.height,
                },
                artboard.bounds
              );
              artboard.draw(renderer);
              ctx.restore();

              requestAnimationFrame(draw);
            }

            requestAnimationFrame(draw);
          });
      });
    </script>
  </body>
</html>
